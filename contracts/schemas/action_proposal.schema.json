{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://hexforge.internal/pla/v1/action_proposal.schema.json",
  "title": "Action Proposal",
  "description": "AI-generated action proposal for operator review (Brain â†’ Operator)",
  "type": "object",
  "required": [
    "proposal_id",
    "timestamp",
    "mode",
    "action_type",
    "payload",
    "rationale",
    "credential_warning",
    "safety_bounds"
  ],
  "properties": {
    "proposal_id": {
      "type": "string",
      "description": "Unique identifier for this proposal (UUID recommended)",
      "pattern": "^[a-zA-Z0-9_-]+$",
      "minLength": 8,
      "maxLength": 64
    },
    "timestamp": {
      "type": "string",
      "description": "ISO 8601 timestamp when proposal was generated",
      "format": "date-time"
    },
    "mode": {
      "type": "string",
      "description": "Current system operating mode",
      "enum": ["OBSERVE", "SUGGEST", "EXECUTE"]
    },
    "action_type": {
      "type": "string",
      "description": "Type of action being proposed",
      "enum": ["TYPE_TEXT", "KEY_COMBO", "MOUSE_MOVE", "MOUSE_CLICK"]
    },
    "payload": {
      "type": "object",
      "description": "Action-specific parameters (validated by action_type)",
      "oneOf": [
        {
          "properties": {
            "text": {
              "type": "string",
              "maxLength": 1024,
              "description": "Text to type (max 1024 chars)"
            }
          },
          "required": ["text"]
        },
        {
          "properties": {
            "keys": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["ctrl", "alt", "shift", "gui", "enter", "escape", "tab", "backspace", "a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z"]
              },
              "minItems": 1,
              "maxItems": 5,
              "description": "Key combination (max 5 keys)"
            }
          },
          "required": ["keys"]
        },
        {
          "properties": {
            "x": {
              "type": "integer",
              "minimum": -1000,
              "maximum": 5000,
              "description": "Relative mouse X movement"
            },
            "y": {
              "type": "integer",
              "minimum": -1000,
              "maximum": 5000,
              "description": "Relative mouse Y movement"
            }
          },
          "required": ["x", "y"]
        },
        {
          "properties": {
            "button": {
              "type": "string",
              "enum": ["left", "right", "middle"],
              "description": "Mouse button to click"
            }
          },
          "required": ["button"]
        }
      ]
    },
    "rationale": {
      "type": "string",
      "description": "AI explanation for why this action is suggested",
      "minLength": 10,
      "maxLength": 2000
    },
    "credential_warning": {
      "type": "boolean",
      "description": "True if AI detected potential credentials in screen/action"
    },
    "safety_bounds": {
      "type": "object",
      "description": "Safety constraints enforced for this action",
      "required": ["max_text_length", "min_action_delay_ms"],
      "properties": {
        "max_text_length": {
          "type": "integer",
          "const": 1024,
          "description": "Maximum characters allowed per TYPE_TEXT action"
        },
        "min_action_delay_ms": {
          "type": "integer",
          "const": 100,
          "description": "Minimum milliseconds between consecutive actions"
        }
      }
    },
    "screen_context": {
      "type": "object",
      "description": "Optional screen state that led to this proposal",
      "properties": {
        "ocr_text": {
          "type": "string",
          "maxLength": 10000,
          "description": "Truncated OCR text from screen"
        },
        "detected_elements": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "UI elements detected (e.g., 'login_button', 'text_field')"
        }
      }
    }
  }
}
