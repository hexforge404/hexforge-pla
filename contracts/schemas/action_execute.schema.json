{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://hexforge.internal/pla/v1/action_execute.schema.json",
  "title": "Action Execute",
  "description": "Command to HID executor to perform approved action (Brain â†’ HID Executor)",
  "type": "object",
  "required": [
    "execution_id",
    "proposal_id",
    "timestamp",
    "mode",
    "action_type",
    "payload",
    "safety_bounds"
  ],
  "properties": {
    "execution_id": {
      "type": "string",
      "description": "Unique identifier for this execution (UUID recommended)",
      "pattern": "^[a-zA-Z0-9_-]+$",
      "minLength": 8,
      "maxLength": 64
    },
    "proposal_id": {
      "type": "string",
      "description": "Links back to original proposal",
      "pattern": "^[a-zA-Z0-9_-]+$",
      "minLength": 8,
      "maxLength": 64
    },
    "timestamp": {
      "type": "string",
      "description": "ISO 8601 timestamp when execution was initiated",
      "format": "date-time"
    },
    "mode": {
      "type": "string",
      "description": "System mode - MUST be EXECUTE for HID actions",
      "const": "EXECUTE"
    },
    "action_type": {
      "type": "string",
      "description": "Type of HID action to execute",
      "enum": ["TYPE_TEXT", "KEY_COMBO", "MOUSE_MOVE", "MOUSE_CLICK"]
    },
    "payload": {
      "type": "object",
      "description": "Action-specific parameters with validated bounds",
      "oneOf": [
        {
          "properties": {
            "text": {
              "type": "string",
              "maxLength": 1024,
              "description": "Text to type (MUST NOT exceed 1024 chars)"
            }
          },
          "required": ["text"]
        },
        {
          "properties": {
            "keys": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "minItems": 1,
              "maxItems": 5,
              "description": "Key combination (max 5 keys)"
            }
          },
          "required": ["keys"]
        },
        {
          "properties": {
            "x": {
              "type": "integer",
              "minimum": -1000,
              "maximum": 5000,
              "description": "Mouse X movement (pixels)"
            },
            "y": {
              "type": "integer",
              "minimum": -1000,
              "maximum": 5000,
              "description": "Mouse Y movement (pixels)"
            }
          },
          "required": ["x", "y"]
        },
        {
          "properties": {
            "button": {
              "type": "string",
              "enum": ["left", "right", "middle"],
              "description": "Mouse button to click"
            }
          },
          "required": ["button"]
        }
      ]
    },
    "safety_bounds": {
      "type": "object",
      "description": "Safety constraints (HID executor MUST enforce)",
      "required": ["max_text_length", "min_action_delay_ms"],
      "properties": {
        "max_text_length": {
          "type": "integer",
          "const": 1024,
          "description": "Maximum characters per TYPE_TEXT"
        },
        "min_action_delay_ms": {
          "type": "integer",
          "const": 100,
          "description": "Minimum delay between actions"
        }
      }
    },
    "operator_approval": {
      "type": "object",
      "description": "Proof of operator approval",
      "required": ["decision_timestamp", "operator_id"],
      "properties": {
        "decision_timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "When operator approved"
        },
        "operator_id": {
          "type": "string",
          "description": "Who approved"
        }
      }
    }
  }
}
